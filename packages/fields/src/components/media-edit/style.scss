@use "@wordpress/base-styles/colors" as *;
@use "@wordpress/base-styles/variables" as *;

@mixin preview-overlay {
	border-radius: $radius-x-small;
	backdrop-filter: blur(16px) saturate(180%);
	background: rgba(255, 255, 255, 0.75);
}

@mixin compact-drop-zone-label {
	// Align text and icons horizontally to avoid clipping when we show the compact placeholder.
	.components-drop-zone .components-drop-zone__content-inner {
		display: flex;
		align-items: center;
		gap: $grid-unit-10;

		.components-drop-zone__content-icon {
			margin: 0;
		}
	}
}

fieldset.fields__media-edit {
	// Reset `fieldset` browser defaults.
	border: 0;
	padding: 0;
	margin: 0;

	width: 100%;

	/* stylelint-disable-next-line property-no-unknown -- '@container' not globally permitted */
	container-type: inline-size;

	.fields__media-edit-compact {
		display: grid;
		grid-template-columns: 1fr auto;
		gap: $grid-unit-10;
		align-items: center;
		@include compact-drop-zone-label;
	}

	// Apply to placeholders outside of expanded view (compact contexts)
	.fields__media-edit-picker-button:has(.fields__media-edit-placeholder):not(.fields__media-edit-expanded *) {
		@include compact-drop-zone-label;
	}

	.fields__media-edit-picker-button {
		position: relative;
		display: flex;
		align-items: center;
		gap: $grid-unit-15;
		border: $border-width dashed $gray-600;
		border-radius: $radius-x-small;
		padding: calc(8px - #{$border-width});
		cursor: pointer;
		min-width: 0;

		&:hover {
			background-color: $gray-100;
		}

		&:focus-visible {
			box-shadow: 0 0 0 var(--wp-admin-border-width-focus) var(--wp-admin-theme-color);
			outline: none;
		}

		&[aria-disabled="true"] {
			opacity: 0.6;
			cursor: default;
		}

		.fields__media-edit-picker-button-spinner {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 1;
		}
	}

	.fields__media-edit-filename,
	.fields__media-edit-placeholder {
		flex: 1;
		width: 100%;
		min-width: 0;
	}

	.fields__media-edit-placeholder {
		text-align: center;
	}

	.fields__media-edit-thumbnail {
		width: $grid-unit-30;
		aspect-ratio: 1 / 1;
		flex-shrink: 0;
		border-radius: $radius-small;
	}

	.fields__media-edit-expanded {
		// Always use grid layout
		display: grid;
		gap: $grid-unit-10;

		&.is-empty {
			@include compact-drop-zone-label;
		}

		.fields__media-edit-expanded-preview {
			position: relative;
			width: 100%;
			aspect-ratio: 3/2;
			border-radius: $radius-small;
			padding: $grid-unit-05;
			overflow: hidden;
			display: flex;
			align-items: center;
			justify-content: center;

			.fields__media-edit-expanded-preview-stack {
				width: 100%;
				height: 100%;
			}
		}

		.fields__media-edit-expanded-overlay {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			opacity: 0;
			pointer-events: none;

			@media not (prefers-reduced-motion) {
				transition: opacity 50ms ease-out;
			}

			* {
				pointer-events: auto;
			}
		}

		.fields__media-edit-expanded-remove {
			position: absolute;
			top: $grid-unit-10;
			right: $grid-unit-10;
			@include preview-overlay;
		}

		.fields__media-edit-expanded-title {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			margin: $grid-unit-10;
			padding: $grid-unit-05;
			text-align: center;
			@include preview-overlay;
		}

		.fields__media-edit-expanded-item {
			position: relative;
			min-width: 0;

			&:hover,
			&:focus-within {
				.fields__media-edit-expanded-overlay {
					opacity: 1;
				}
			}

			&:not(.has-preview-image) {
				.fields__media-edit-expanded-preview-stack {
					padding: $grid-unit-10;
				}
			}
		}

		.fields__media-edit-thumbnail {
			width: 100%;
			height: 100%;
			object-fit: cover;
			object-position: 50% 50%;
		}

		.fields__media-edit-filename {
			text-align: center;
			flex: none;
		}

		.fields__media-edit-picker-button-spinner {
			svg {
				margin: 0;
			}
		}

		&.is-single {
			grid-template-columns: 1fr;

			.fields__media-edit-expanded-preview {
				aspect-ratio: 2/1;
			}
		}

		&.is-multiple:not(.is-empty) {
			grid-template-columns: repeat(3, 1fr);

			/* stylelint-disable-next-line property-no-unknown -- '@container' not globally permitted */
			@container (max-width: 768px) {
				grid-template-columns: repeat(2, 1fr);
			}

			/* stylelint-disable-next-line property-no-unknown -- '@container' not globally permitted */
			@container (max-width: 280px) {
				grid-template-columns: 1fr;
			}
		}

		&:not(.is-empty) {
			.fields__media-edit-picker-button {
				padding: 0;
			}

			.fields__media-edit-placeholder {
				display: flex;
				align-items: center;
				justify-content: center;
				aspect-ratio: 3/2;
			}
		}
	}
}
